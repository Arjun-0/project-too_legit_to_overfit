---
title: "How do Certain Factors Affect the Ratings of Boardgames?"
subtitle: "Too Legit to Overfit"
author: "Archie Cannon, Arjun Nanning Ramamurthy, Bruce McPhail, Connor Williams"
institute: "University of Edinburgh"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightLines: true
      countIncrementalSlides: false
---

```{r load-packages, include = FALSE}
library(tidyverse)
library(tidymodels)
library(knitr)
library(here)
library(xaringanthemer)
```

```{r setup, include = FALSE}
knitr::opts_chunk$set(fig.retina = 3, dpi = 300, fig.width = 6, fig.asp = 0.618, out.width = "80%")
```

```{r r-squared, echo = FALSE}
display_r_squared <- function(fit) {
  paste0(
    "$$R^2=",
    round(glance(fit)$r.squared[1], 3),
    ",R_{adj}^2=",
    round(glance(fit)$adj.r.squared[1], 3),
    ".$$"
  )
}
```

```{r load-data, include = FALSE}
board_games <- read_csv(here("data/board_games.csv"))
```

```{r glimpse, echo = FALSE}
glimpse(board_games)
```

---

# Categories

```{r popular-categories, echo = FALSE}
board_games_splitcats <- board_games %>% 
  mutate(categories = str_split(category, ","))

popular_categories <- board_games_splitcats %>%
  pull(categories) %>%
  unlist %>%
  as_tibble %>%
  count(value) %>%
  arrange(desc(n)) %>%
  head(6)

popular_categories %>%
  knitr::kable()

popular_categories <- pull(popular_categories, value)
```

---

# Year published

```{r year-published-rating, echo = FALSE, message = FALSE}
board_games %>%
  group_by(year_published) %>%
  summarise(rating = mean(average_rating)) %>%
  ggplot(aes(
    x = year_published,
    y = rating
  )) +
  geom_line() +
  theme_minimal() +
  labs(
    x = "Year Published",
    y = "Rating"
  )
```

---

```{r year-published-rating-fit, echo = FALSE}
year_published_rating_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(average_rating ~ year_published, data = board_games)
```

```{r year-published-rating-line, echo = FALSE, message = FALSE}
board_games %>%
  group_by(year_published) %>%
  summarise(rating = mean(average_rating)) %>%
  ggplot(aes(
    x = year_published,
    y = rating
  )) +
  geom_line() +
	geom_smooth(method = "lm") +
  theme_minimal() +
  labs(
    x = "Year Published",
    y = "Rating"
  )
```

`r display_r_squared(year_published_rating_fit)`

---

# Playing time

---

# Users rated

---

# Interesting observations

```{r popular-categories-year-published, echo = FALSE, message = FALSE}
board_games_splitcats <- board_games %>% 
  mutate(categories = str_split(category, ","))

popular_categories <- board_games_splitcats %>%
  pull(categories) %>%
  unlist %>%
  as_tibble %>%
  count(value) %>%
  arrange(desc(n)) %>%
  head(6) %>%
  pull(value)

board_games_empty <- board_games_splitcats %>%
  filter(FALSE)
board_games_popcats <- board_games_empty

for (c in popular_categories) {
  board_games_popcats <- full_join(
    board_games_popcats,
    board_games_splitcats %>%
      filter(map_lgl(categories, ~c %in% .x)) %>%
      mutate(category = c)
  )
}

board_games_popcats %>%
  group_by(category, year_published) %>%
  summarise(count = n()) %>%
  ggplot(aes(
    x = year_published,
    y = count,
    color = category
  )) +
  geom_line() +
  theme_minimal() +
  labs(
    x = "Year Published",
    y = "Number of Games",
    color = "Category"
  )
```

---

# Conclusion
